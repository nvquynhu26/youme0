<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>세계 GDP 대륙별 네온 분석 대시보드</title>
    <!-- Tailwind CSS 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- D3.js 로드 (지도 및 차트 시각화용) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <!-- Inter 폰트 및 네온 테마 스타일 -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000; /* 배경 검은색 */
            color: #E5E7EB; /* 기본 텍스트 밝은 회색 */
        }
        .neon-glow {
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.6), 0 0 5px rgba(0, 255, 255, 0.4);
        }
        .neon-text-cyan {
            color: #00FFFF;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.8);
        }
        .bar-label {
            font-size: 0.75rem;
            fill: #E5E7EB; /* 밝은 회색 */
        }
        /* 드롭다운 및 검색창 스타일 */
        .neon-input {
            background-color: #1F2937; /* 다크 그레이 */
            color: #E5E7EB; /* 밝은 텍스트 */
            border-color: #00FFFF; /* 네온 시안 테두리 */
            box-shadow: 0 0 5px rgba(0, 255, 255, 0.4);
        }
        .neon-input:focus {
            ring-color: #FF00FF !important; /* 네온 마젠타 링 */
            border-color: #FF00FF !important;
        }
        /* 지도 외곽선 스타일 개선 (더 굵게) */
        .continent-border {
            fill: #111827; /* 어두운 배경 채우기 */
            stroke: #00FFFF; /* 네온 시안 테두리 */
            stroke-width: 1.5px; /* 두께 증가 */
            filter: drop-shadow(0 0 2px #00FFFF); /* 더 강한 빛 효과 */
            opacity: 0.7;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <div id="app" class="max-w-5xl mx-auto bg-gray-900 p-6 md:p-10 rounded-xl shadow-2xl neon-glow">
        <h1 class="text-3xl font-extrabold mb-6 border-b border-gray-700 pb-3 text-center neon-text-cyan">
            세계 GDP 대륙별 네온 분석 대시보드
        </h1>

        <!-- 제어판 (Control Panel) -->
        <div class="flex flex-col sm:flex-row gap-4 mb-8">
            
            <!-- 1. 대륙 선택 드롭다운 -->
            <div class="w-full sm:w-1/2">
                <label for="continent-select" class="block text-sm font-medium text-gray-400 mb-1">
                    대륙 선택
                </label>
                <select id="continent-select" class="w-full p-3 rounded-lg shadow-sm transition duration-150 ease-in-out appearance-none cursor-pointer neon-input">
                    <!-- 옵션은 JS에서 채워집니다. -->
                </select>
            </div>

            <!-- 2. 국가 검색 입력창 -->
            <div class="w-full sm:w-1/2">
                <label for="country-search" class="block text-sm font-medium text-gray-400 mb-1">
                    국가 검색 (이름 입력)
                </label>
                <input type="text" id="country-search" placeholder="예: 대한민국, 미국..." class="w-full p-3 rounded-lg shadow-sm transition duration-150 ease-in-out placeholder-gray-500 neon-input">
            </div>
        </div>
        
        <!-- --- 1. GDP 막대 차트 영역 --- -->
        <h2 class="text-2xl font-bold mb-4 pt-4 border-t border-gray-700 neon-text-cyan">
            대륙/국가별 GDP 순위 (조 달러)
        </h2>
        <div id="chart-container" class="bg-gray-800 p-4 md:p-6 rounded-xl shadow-inner min-h-64 neon-glow border border-gray-700">
            <div id="chart-info" class="text-center text-lg font-semibold text-gray-400 mb-4">
                선택된 데이터가 여기에 표시됩니다.
            </div>
            <div id="bar-chart" class="w-full overflow-x-auto">
                <!-- SVG 차트가 여기에 그려집니다. -->
            </div>
        </div>
        
        <!-- --- 2. 세계 지도 시각화 영역 --- -->
        <h2 class="text-2xl font-bold mb-4 pt-8 border-t border-gray-700 mt-8 neon-text-cyan">
            국가 발전 상태 지도
        </h2>
        <div id="world-map-container" class="bg-gray-800 p-4 md:p-6 rounded-xl shadow-inner min-h-64 neon-glow border border-gray-700 flex flex-col items-center">
            <div id="map-legend" class="mb-4 flex gap-4 text-sm font-semibold">
                <!-- 범례는 JS에서 채워집니다 -->
            </div>
            <svg id="world-map" class="w-full" viewBox="0 0 960 500"></svg>
        </div>
        
        <p class="mt-8 text-xs text-gray-600 text-center">
            * 이 데이터는 모의 데이터입니다. GDP 단위는 조 달러(Trillion USD)입니다. 지도 시각화는 단일 파일 구성을 위해 간소화된 지역 좌표를 사용했습니다.
        </p>
    </div>

    <script>
        // API 키 변수는 Canvas 환경에서 제공됩니다.
        const apiKey = "";
        
        // --- 1. 모의 데이터 설정 (GDP 및 발전 상태 추가) ---
        const MOCK_GDP_DATA = [
            // 아시아
            { country: "중국", continent: "아시아", gdp: 17.7, status: "개발도상국", coords: [103.8, 30.0] },
            { country: "일본", continent: "아시아", gdp: 4.2, status: "선진국", coords: [138.0, 36.0] },
            { country: "인도", continent: "아시아", gdp: 3.7, status: "개발도상국", coords: [77.2, 20.6] },
            { country: "대한민국", continent: "아시아", gdp: 1.7, status: "선진국", coords: [127.8, 36.5] },
            { country: "인도네시아", continent: "아시아", gdp: 1.4, status: "개발도상국", coords: [113.9, -0.8] },
            { country: "사우디아라비아", continent: "아시아", gdp: 1.1, status: "개발도상국", coords: [45.0, 24.0] },
            { country: "베트남", continent: "아시아", gdp: 0.43, status: "개발도상국", coords: [108.2, 16.0] },

            // 북미
            { country: "미국", continent: "북미", gdp: 27.9, status: "선진국", coords: [-98.5, 39.8] },
            { country: "캐나다", continent: "북미", gdp: 2.2, status: "선진국", coords: [-106.3, 56.1] },
            { country: "멕시코", continent: "북미", gdp: 1.8, status: "개발도상국", coords: [-102.0, 23.6] },
            
            // 유럽
            { country: "독일", continent: "유럽", gdp: 4.5, status: "선진국", coords: [10.4, 51.2] },
            { country: "영국", continent: "유럽", gdp: 3.5, status: "선진국", coords: [-2.0, 55.4] },
            { country: "프랑스", continent: "유럽", gdp: 3.2, status: "선진국", coords: [2.3, 46.2] },
            { country: "이탈리아", continent: "유럽", gdp: 2.3, status: "선진국", coords: [12.5, 41.9] },
            
            // 남미
            { country: "브라질", continent: "남미", gdp: 2.1, status: "개발도상국", coords: [-51.9, -14.2] },
            { country: "아르헨티나", continent: "남미", gdp: 0.63, status: "개발도상국", coords: [-63.6, -38.4] },
            
            // 아프리카
            { country: "나이지리아", continent: "아프리카", gdp: 0.55, status: "최빈국", coords: [8.0, 9.0] },
            { country: "남아프리카공화국", continent: "아프리카", gdp: 0.4, status: "개발도상국", coords: [22.9, -30.6] },
            { country: "이집트", continent: "아프리카", gdp: 0.35, status: "개발도상국", coords: [30.8, 26.8] },
            { country: "에티오피아", continent: "아프리카", gdp: 0.15, status: "최빈국", coords: [39.0, 8.0] },
            
            // 오세아니아
            { country: "호주", continent: "오세아니아", gdp: 1.7, status: "선진국", coords: [133.8, -25.3] },
            { country: "뉴질랜드", continent: "오세아니아", gdp: 0.28, status: "선진국", coords: [174.9, -40.9] },
        ];
        
        // --- 2. 단순화된 GeoJSON 데이터 (단일 파일 구성을 위한 대륙 외곽선 모의 데이터) ---
        const mockGeoJson = {
            type: "FeatureCollection",
            features: [
                // 아시아
                { type: "Feature", properties: { continent: "아시아" }, geometry: { type: "Polygon", coordinates: [[[40, 70], [150, 70], [150, -10], [40, -10], [40, 70]]] } },
                // 유럽
                { type: "Feature", properties: { continent: "유럽" }, geometry: { type: "Polygon", coordinates: [[[-20, 75], [50, 75], [50, 40], [10, 30], [-20, 55], [-20, 75]]] } },
                // 북미
                { type: "Feature", properties: { continent: "북미" }, geometry: { type: "Polygon", coordinates: [[[-170, 80], [-60, 80], [-60, 10], [-130, 20], [-170, 80]]] } },
                // 남미
                { type: "Feature", properties: { continent: "남미" }, geometry: { type: "Polygon", coordinates: [[[-85, 10], [-30, 0], [-50, -60], [-85, -50], [-85, 10]]] } },
                // 아프리카
                { type: "Feature", properties: { continent: "아프리카" }, geometry: { type: "Polygon", coordinates: [[[-20, 35], [50, 35], [50, -35], [10, -35], [-20, 35]]] } },
                // 오세아니아
                { type: "Feature", properties: { continent: "오세아니아" }, geometry: { type: "Polygon", coordinates: [[[100, 0], [160, 0], [160, -45], [100, -45], [100, 0]]] } },
            ]
        };


        const continents = [...new Set(MOCK_GDP_DATA.map(d => d.continent))].sort();
        const continentSelect = document.getElementById('continent-select');
        const countrySearchInput = document.getElementById('country-search');
        const barChart = document.getElementById('bar-chart');
        const chartInfo = document.getElementById('chart-info');
        const worldMapSvg = d3.select("#world-map");
        const mapWidth = 960, mapHeight = 500;
        
        let currentFilter = {
            continent: '전체 대륙',
            search: ''
        };

        // --- 3. 색상 및 스타일 상수 ---
        const NEON_COLORS = {
            // 대륙별 색상 (막대 차트용)
            '아시아': '#FFD700', // Gold/Yellow Neon
            '유럽': '#FF69B4', // Hot Pink Neon
            '북미': '#00BFFF', // Deep Sky Blue Neon
            '남미': '#32CD32', // Lime Green Neon
            '아프리카': '#FFA500', // Orange Neon
            '오세아니아': '#9932CC', // Dark Orchid Neon
            
            // 발전 상태 색상 (지도 점 시각화용) - 요청된 네온 톤 사용
            '선진국': '#00FFFF', // Cyan Neon
            '개발도상국': '#FF00FF', // Magenta Neon
            '최빈국': '#00FF00', // Lime Neon
        };
        const STATUS_LEGEND = {
            '선진국': NEON_COLORS['선진국'],
            '개발도상국': NEON_COLORS['개발도상국'],
            '최빈국': NEON_COLORS['최빈국']
        };

        // --- 4. 초기화 함수 ---
        function initializeControls() {
            // 대륙 선택 드롭다운 초기화
            let optionsHtml = `<option value="전체 대륙">전체 대륙</option>`;
            continents.forEach(cont => {
                optionsHtml += `<option value="${cont}">${cont}</option>`;
            });
            continentSelect.innerHTML = optionsHtml;

            // 이벤트 리스너 설정
            continentSelect.addEventListener('change', (e) => {
                currentFilter.continent = e.target.value;
                countrySearchInput.value = ''; // 대륙 선택 시 검색 초기화
                currentFilter.search = '';
                renderBarChart();
            });

            countrySearchInput.addEventListener('input', (e) => {
                currentFilter.search = e.target.value.trim();
                continentSelect.value = '전체 대륙'; // 검색 시 대륙 필터 초기화
                currentFilter.continent = '전체 대륙';
                renderBarChart();
            });

            renderBarChart(); // 초기 막대 차트 렌더링
            renderMap();      // 초기 지도 렌더링
            renderMapLegend(); // 범례 렌더링
        }

        // --- 5. 막대 차트 렌더링 함수 ---
        function renderBarChart() {
            let data = MOCK_GDP_DATA;

            // 1. 데이터 필터링
            if (currentFilter.continent !== '전체 대륙') {
                data = data.filter(d => d.continent === currentFilter.continent);
            }
            if (currentFilter.search) {
                const searchLower = currentFilter.search.toLowerCase();
                data = data.filter(d => d.country.toLowerCase().includes(searchLower));
            }
            
            // 2. 데이터 정렬 (GDP 기준 내림차순)
            data.sort((a, b) => b.gdp - a.gdp);

            // 차트 정보 업데이트
            if (data.length === 0) {
                chartInfo.textContent = '일치하는 국가를 찾을 수 없습니다.';
                barChart.innerHTML = '';
                return;
            } else {
                let infoText = '총 ' + data.length + '개 국가 데이터 표시';
                if (currentFilter.continent !== '전체 대륙') {
                    infoText = currentFilter.continent + ' 대륙의 ' + data.length + '개 국가 데이터 표시';
                }
                if (currentFilter.search) {
                    infoText = "'" + currentFilter.search + "' 검색 결과 (" + data.length + "개 국가)";
                }
                chartInfo.textContent = infoText;
            }

            // SVG 차트 크기 및 설정
            const chartWidth = 700;
            const barHeight = 35;
            const barSpacing = 10;
            const svgHeight = data.length * (barHeight + barSpacing) + 20;
            const maxGdp = Math.max(...MOCK_GDP_DATA.map(d => d.gdp));
            const scaleFactor = (chartWidth - 150) / maxGdp;

            let svgContent = `<svg viewBox="0 0 ${chartWidth} ${svgHeight}" width="100%" height="${svgHeight}" xmlns="http://www.w3.org/2000/svg" class="select-none">`;

            data.forEach((d, index) => {
                const y = index * (barHeight + barSpacing) + 10;
                const barWidth = d.gdp * scaleFactor;
                const color = NEON_COLORS[d.continent] || '#FFFFFF'; // 대륙별 네온 색상

                // 막대 (Bar)
                svgContent += `<rect 
                    x="50" y="${y}" 
                    width="${barWidth}" height="${barHeight}" 
                    fill="${color}" 
                    rx="6" ry="6" 
                    class="transition-all duration-500 ease-out"
                    style="opacity: 0.8; box-shadow: 0 0 5px ${color};"
                />`;

                // 국가 레이블 (Country Label)
                svgContent += `<text 
                    x="40" y="${y + barHeight / 2 + 5}" 
                    text-anchor="end" 
                    class="bar-label font-semibold"
                >
                    ${d.country}
                </text>`;

                // GDP 값 레이블 (Value Label)
                svgContent += `<text 
                    x="${50 + barWidth + 10}" y="${y + barHeight / 2 + 5}" 
                    text-anchor="start" 
                    class="bar-label font-medium" fill="${color}"
                >
                    ${d.gdp.toFixed(2)} 조 달러
                </text>`;
            });

            svgContent += `</svg>`;
            barChart.innerHTML = svgContent;
            barChart.style.minWidth = `${chartWidth}px`;
        }

        // --- 6. 세계 지도 렌더링 함수 (D3 사용) ---
        function renderMap() {
            worldMapSvg.attr("width", mapWidth)
                       .attr("height", mapHeight)
                       .style("background-color", "#111827"); // 다크한 지도 배경
            
            // D3 투영 (Mercator)
            const projection = d3.geoMercator()
                .scale(150)
                .center([0, 20]) // 중앙 조정
                .translate([mapWidth / 2, mapHeight / 2]);

            const path = d3.geoPath().projection(projection);

            // 기존 지도 요소 제거
            worldMapSvg.selectAll('*').remove();
            
            // 1. 대륙 외곽선 그리기 (GeoJSON 사용) - 지도의 윤곽선을 제공
            worldMapSvg.selectAll("path.continent-border")
                .data(mockGeoJson.features)
                .enter().append("path")
                .attr("class", "continent-border")
                .attr("d", path)
                .attr("fill", "#1F2937") 
                .attr("stroke", NEON_COLORS['선진국']) 
                .attr("stroke-width", 1.5); // 두께 개선


            // 2. 국가별 점 (Dot) 그리기 (발전 상태 색상 적용) - 요청에 따라 색상 구분
            worldMapSvg.selectAll("circle.country-dot")
                .data(MOCK_GDP_DATA)
                .enter().append("circle")
                .attr("class", "country-dot")
                .attr("cx", d => projection(d.coords)[0])
                .attr("cy", d => projection(d.coords)[1])
                .attr("r", 7)
                .attr("fill", d => NEON_COLORS[d.status]) // 발전 상태에 따른 색상 적용
                .attr("stroke", "#FFFFFF")
                .attr("stroke-width", 1.5)
                .style("cursor", "pointer")
                .style("filter", d => `drop-shadow(0 0 5px ${NEON_COLORS[d.status]})`)
                .on("mouseover", function(event, d) {
                    d3.select(this)
                        .attr("r", 10)
                        .attr("stroke-width", 2)
                        .style("filter", d => `drop-shadow(0 0 15px ${NEON_COLORS[d.status]})`);
                    
                    // 툴팁 표시
                    worldMapSvg.append("text")
                        .attr("class", "country-label")
                        .attr("x", projection(d.coords)[0] + 12)
                        .attr("y", projection(d.coords)[1] + 5)
                        .attr("fill", NEON_COLORS[d.status])
                        .attr("font-size", "14px")
                        .attr("font-weight", "bold")
                        .text(`${d.country} (${d.status})`);
                })
                .on("mouseout", function(event, d) {
                    d3.select(this)
                        .attr("r", 7)
                        .attr("stroke-width", 1.5)
                        .style("filter", d => `drop-shadow(0 0 5px ${NEON_COLORS[d.status]})`);
                    
                    worldMapSvg.select(".country-label").remove();
                });
        }
        
        // --- 7. 지도 범례 렌더링 함수 ---
        function renderMapLegend() {
            const legendContainer = document.getElementById('map-legend');
            legendContainer.innerHTML = '';

            Object.keys(STATUS_LEGEND).forEach(status => {
                const color = STATUS_LEGEND[status];
                const item = document.createElement('div');
                item.className = 'flex items-center gap-2 px-3 py-1 rounded-full bg-gray-700 hover:bg-gray-600 transition duration-150';
                
                const dot = document.createElement('span');
                dot.className = 'inline-block w-3 h-3 rounded-full';
                dot.style.backgroundColor = color;
                dot.style.boxShadow = `0 0 5px ${color}`;

                const text = document.createElement('span');
                text.className = 'font-medium text-sm';
                text.style.color = color;
                text.textContent = status;

                item.appendChild(dot);
                item.appendChild(text);
                legendContainer.appendChild(item);
            });
        }


        // 앱 시작
        window.onload = initializeControls;

    </script>
</body>
</html>
