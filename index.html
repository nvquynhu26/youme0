<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GDP 대륙별/국가별 시각화</title>
    <!-- Tailwind CSS 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter 폰트 사용 -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        /* SVG 바 차트 스타일 */
        .bar-label {
            font-size: 0.75rem; /* text-xs */
            fill: #374151; /* gray-700 */
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <div id="app" class="max-w-4xl mx-auto bg-white p-6 md:p-10 rounded-xl shadow-2xl">
        <h1 class="text-3xl font-extrabold text-gray-900 mb-6 border-b pb-3 text-center">
            세계 GDP 대륙별 분석
        </h1>

        <!-- 제어판 (Control Panel) -->
        <div class="flex flex-col sm:flex-row gap-4 mb-8">
            
            <!-- 1. 대륙 선택 드롭다운 -->
            <div class="w-full sm:w-1/2">
                <label for="continent-select" class="block text-sm font-medium text-gray-700 mb-1">
                    대륙 선택
                </label>
                <select id="continent-select" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out bg-gray-50 appearance-none cursor-pointer">
                    <!-- 옵션은 JS에서 채워집니다. -->
                </select>
                <!-- 드롭다운 아이콘을 위한 Tailwind 꼼수 -->
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-700">
                    <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </div>
            </div>

            <!-- 2. 국가 검색 입력창 -->
            <div class="w-full sm:w-1/2">
                <label for="country-search" class="block text-sm font-medium text-gray-700 mb-1">
                    국가 검색 (이름 입력)
                </label>
                <input type="text" id="country-search" placeholder="예: 대한민국, 미국..." class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out placeholder-gray-400">
            </div>
        </div>
        
        <!-- 차트 영역 -->
        <div id="chart-container" class="bg-gray-50 p-4 md:p-6 rounded-xl shadow-inner min-h-96">
            <div id="chart-info" class="text-center text-lg font-semibold text-gray-600 mb-4">
                선택된 데이터가 여기에 표시됩니다.
            </div>
            <div id="bar-chart" class="w-full overflow-x-auto">
                <!-- SVG 차트가 여기에 그려집니다. -->
            </div>
        </div>
        
        <!-- API 키 안내 (불필요하지만 구조 유지를 위해 포함) -->
        <p class="mt-8 text-xs text-gray-500 text-center">
            * 이 데이터는 모의 데이터입니다. GDP 단위는 조 달러(Trillion USD)입니다.
        </p>
    </div>

    <script>
        // API 키 변수는 Canvas 환경에서 제공됩니다.
        const apiKey = "";
        
        // --- 1. 모의 데이터 설정 (Trillion USD) ---
        const MOCK_GDP_DATA = [
            // 아시아
            { country: "중국", continent: "아시아", gdp: 17.7 },
            { country: "일본", continent: "아시아", gdp: 4.2 },
            { country: "인도", continent: "아시아", gdp: 3.7 },
            { country: "대한민국", continent: "아시아", gdp: 1.7 },
            { country: "인도네시아", continent: "아시아", gdp: 1.4 },
            { country: "사우디아라비아", continent: "아시아", gdp: 1.1 },

            // 북미
            { country: "미국", continent: "북미", gdp: 27.9 },
            { country: "캐나다", continent: "북미", gdp: 2.2 },
            { country: "멕시코", continent: "북미", gdp: 1.8 },
            
            // 유럽
            { country: "독일", continent: "유럽", gdp: 4.5 },
            { country: "영국", continent: "유럽", gdp: 3.5 },
            { country: "프랑스", continent: "유럽", gdp: 3.2 },
            { country: "이탈리아", continent: "유럽", gdp: 2.3 },
            
            // 남미
            { country: "브라질", continent: "남미", gdp: 2.1 },
            { country: "아르헨티나", continent: "남미", gdp: 0.63 },
            
            // 아프리카
            { country: "나이지리아", continent: "아프리카", gdp: 0.55 },
            { country: "남아프리카공화국", continent: "아프리카", gdp: 0.4 },
            { country: "이집트", continent: "아프리카", gdp: 0.35 },
            
            // 오세아니아
            { country: "호주", continent: "오세아니아", gdp: 1.7 },
            { country: "뉴질랜드", continent: "오세아니아", gdp: 0.28 },
        ];

        // 대륙 목록을 추출하고 한국어 레이블을 추가합니다.
        const continents = [...new Set(MOCK_GDP_DATA.map(d => d.continent))].sort();
        const continentMap = {
            "아시아": "아시아", "북미": "북미", "유럽": "유럽", 
            "남미": "남미", "아프리카": "아프리카", "오세아니아": "오세아니아"
        };
        const continentSelect = document.getElementById('continent-select');
        const countrySearchInput = document.getElementById('country-search');
        const barChart = document.getElementById('bar-chart');
        const chartInfo = document.getElementById('chart-info');
        
        let currentFilter = {
            continent: '전체 대륙',
            search: ''
        };

        // --- 2. 초기화 함수 ---
        function initializeControls() {
            // 대륙 선택 드롭다운 초기화
            let optionsHtml = `<option value="전체 대륙">전체 대륙</option>`;
            continents.forEach(cont => {
                optionsHtml += `<option value="${cont}">${continentMap[cont] || cont}</option>`;
            });
            continentSelect.innerHTML = optionsHtml;

            // 이벤트 리스너 설정
            continentSelect.addEventListener('change', (e) => {
                currentFilter.continent = e.target.value;
                countrySearchInput.value = ''; // 대륙 선택 시 검색 초기화
                currentFilter.search = '';
                renderChart();
            });

            countrySearchInput.addEventListener('input', (e) => {
                currentFilter.search = e.target.value.trim();
                continentSelect.value = '전체 대륙'; // 검색 시 대륙 필터 초기화
                currentFilter.continent = '전체 대륙';
                renderChart();
            });

            renderChart(); // 초기 렌더링
        }

        // --- 3. 차트 렌더링 함수 ---
        function renderChart() {
            let data = MOCK_GDP_DATA;

            // 1. 데이터 필터링 (대륙)
            if (currentFilter.continent !== '전체 대륙') {
                data = data.filter(d => d.continent === currentFilter.continent);
            }

            // 2. 데이터 필터링 (검색)
            if (currentFilter.search) {
                const searchLower = currentFilter.search.toLowerCase();
                data = data.filter(d => d.country.toLowerCase().includes(searchLower));
            }
            
            // 3. 데이터 정렬 (GDP 기준 내림차순)
            data.sort((a, b) => b.gdp - a.gdp);

            // 차트 정보 업데이트
            if (data.length === 0) {
                chartInfo.textContent = '일치하는 국가를 찾을 수 없습니다.';
                barChart.innerHTML = '';
                return;
            } else {
                let infoText = '총 ' + data.length + '개 국가 데이터 표시';
                if (currentFilter.continent !== '전체 대륙') {
                    infoText = currentFilter.continent + ' 대륙의 ' + data.length + '개 국가 데이터 표시';
                }
                if (currentFilter.search) {
                    infoText = "'" + currentFilter.search + "' 검색 결과 (' + data.length + '개 국가)";
                }
                chartInfo.textContent = infoText;
            }

            // SVG 차트 크기 및 설정
            const chartWidth = 700; // SVG 너비 (오버플로 X를 위해 고정)
            const barHeight = 35; // 각 막대의 높이
            const barSpacing = 10; // 막대 사이 간격
            const svgHeight = data.length * (barHeight + barSpacing) + 20; // 전체 SVG 높이
            const maxGdp = Math.max(...data.map(d => d.gdp));
            const scaleFactor = (chartWidth - 150) / maxGdp; // 오른쪽 150px는 레이블 공간

            let svgContent = `<svg viewBox="0 0 ${chartWidth} ${svgHeight}" width="100%" height="${svgHeight}" xmlns="http://www.w3.org/2000/svg" class="select-none">`;

            data.forEach((d, index) => {
                const y = index * (barHeight + barSpacing) + 10;
                const barWidth = d.gdp * scaleFactor;
                const color = getColorForContinent(d.continent);

                // 막대 (Bar)
                svgContent += `<rect 
                    x="50" y="${y}" 
                    width="${barWidth}" height="${barHeight}" 
                    fill="${color}" 
                    rx="6" ry="6" 
                    class="transition-all duration-500 ease-out"
                    style="opacity: 0.9;"
                />`;

                // 국가 레이블 (Country Label)
                svgContent += `<text 
                    x="40" y="${y + barHeight / 2 + 5}" 
                    text-anchor="end" 
                    class="bar-label font-semibold text-gray-900"
                >
                    ${d.country}
                </text>`;

                // GDP 값 레이블 (Value Label)
                svgContent += `<text 
                    x="${50 + barWidth + 10}" y="${y + barHeight / 2 + 5}" 
                    text-anchor="start" 
                    class="bar-label font-medium text-gray-700"
                >
                    ${d.gdp.toFixed(2)} 조 달러
                </text>`;
            });

            svgContent += `</svg>`;
            barChart.innerHTML = svgContent;

            // 차트 컨테이너가 SVG 너비보다 작을 경우 스크롤 표시
            barChart.style.minWidth = `${chartWidth}px`;
        }

        // --- 4. 대륙별 색상 함수 ---
        function getColorForContinent(continent) {
            switch (continent) {
                case '아시아':
                    return '#EF4444'; // Red-500
                case '유럽':
                    return '#3B82F6'; // Blue-500
                case '북미':
                    return '#10B981'; // Emerald-500
                case '남미':
                    return '#F59E0B'; // Amber-500
                case '아프리카':
                    return '#8B5CF6'; // Violet-500
                case '오세아니아':
                    return '#06B6D4'; // Cyan-500
                default:
                    return '#6B7280'; // Gray-500
            }
        }

        // 앱 시작
        window.onload = initializeControls;

    </script>
</body>
</html>
