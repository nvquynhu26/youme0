<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>2020-2025년 국가별 GDP 소득 변화</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: 'Noto Sans KR', Arial, sans-serif; }
    .search-box { margin-bottom: 15px; }
    input[type="text"] { width: 250px; padding: 8px; }
    label { font-weight: bold; margin-right: 10px; }
  </style>
</head>
<body>
  <h2>2020-2025년 국가별 GDP 소득 변화</h2>
  <div class="search-box">
    <label for="countrySearch">국가명 또는 지역 검색:</label>
    <input type="text" id="countrySearch" placeholder="국가명/지역명을 입력하세요…">
  </div>
  <canvas id="gdpChart" width="1800" height="600"></canvas>

  <script>
    // 국가명 한글 변환 예시 일부 추가 (실제 적용 시 전체 국가명 한글화 필요)
    const countryKo = {
      "Afghanistan": "아프가니스탄",
      "Albania": "알바니아",
      "Algeria": "알제리",
      "South Korea": "대한민국",
      "Vietnam": "베트남",
      "China": "중국",
      "Japan": "일본",
      "United States": "미국",
      // ... 나머지 국가들 한글화 필요
    };

    // 원본 데이터 배열 (표본, 전체 데이터 입력 필요)
    const gdpData = [
      {Country: "Afghanistan", "2020":20136, "2021":14278, "2022":14501, "2023":17248, "2024":"", "2025":""},
      {Country: "Albania", "2020":15271, "2021":18086, "2022":19185, "2023":23388, "2024":27259, "2025":28372},
      {Country: "Algeria", "2020":164774, "2021":185850, "2022":225709, "2023":247789, "2024":264913, "2025":268885},
      {Country: "South Korea", "2020":1744456, "2021":1942314, "2022":1799363, "2023":1839058, "2024":1869714, "2025":1790322},
      {Country: "Vietnam", "2020":346310, "2021":370076, "2022":411068, "2023":433008, "2024":459472, "2025":490970},
      {Country: "China", "2020":15103357, "2021":18190803, "2022":18307816, "2023":18270351, "2024":18748009, "2025":19231705},
      {Country: "United States", "2020":21354125, "2021":23681175, "2022":26006900, "2023":27720725, "2024":29184900, "2025":30507217},
      // ... 전체 데이터 입력
    ];

    // Chart.js에 입력할 데이터 포맷 가공
    function makeDatasets(filtered) {
      return filtered.map(item => ({
        label: countryKo[item.Country] || item.Country,
        data: [
          item["2020"] || null,
          item["2021"] || null,
          item["2022"] || null,
          item["2023"] || null,
          item["2024"] || null,
          item["2025"] || null
        ],
        borderWidth: 2,
        borderColor: 'rgba(' + Math.floor(Math.random()*256) + ',' 
                              + Math.floor(Math.random()*256) + ',' 
                              + Math.floor(Math.random()*256) + ',1)',
        fill: false,
        spanGaps: true,
      }));
    }

    const years = ["2020", "2021", "2022", "2023", "2024", "2025"];
    const chartCtx = document.getElementById('gdpChart').getContext('2d');
    let chartInstance = new Chart(chartCtx, {
      type: 'line',
      data: {
        labels: years,
        datasets: makeDatasets(gdpData),
      },
      options: {
        responsive: false,
        plugins: {
          legend: {
            display: false // 초기 범례 감춤
          },
          tooltip: {
            callbacks: {
              title: (context) => context[0].dataset.label
            }
          }
        },
        interaction: {
          mode: 'nearest',
          axis: 'x',
          intersect: false
        },
        scales: {
          x: {
            title: {
              display: true,
              text: '연도'
            }
          },
          y: {
            title: {
              display: true,
              text: 'GDP 소득(US 달러)'
            },
            beginAtZero: true
          }
        }
      }
    });

    // 검색 기능 추가
    document.getElementById('countrySearch').addEventListener('input', function() {
      const q = this.value.trim();
      let filtered = gdpData;
      if(q) {
        filtered = gdpData.filter(item => {
          const koName = countryKo[item.Country] || item.Country;
          return koName.includes(q) || item.Country.toLowerCase().includes(q.toLowerCase());
        });
      }
      chartInstance.data.datasets = makeDatasets(filtered);
      chartInstance.update();
    });
  </script>
</body>
</html>
